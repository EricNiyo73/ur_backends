{"version":3,"file":"AdminController.js","names":["_AdminModel","_interopRequireDefault","require","_bookUserModel","_express","_bodyParser","_multer","_dotenv","_nodemailer","_cloudinary","obj","__esModule","default","router","Router","path","dotenv","config","app","express","use","json","static","join","process","cwd","bodyParser","urlencoded","extended","cloudinary","cloud_name","env","CLOUDNAME","api_key","API_KEY","api_secret","API_SECRET","upload","multer","storage","diskStorage","fileFilter","req","file","cb","ext","extname","originalname","Error","error","exports","createfacility","res","next","send","result","uploader","newfacility","facility","body","desc","image","secure_url","savedfacility","save","status","err","updatefacility","updatedfacility","findByIdAndUpdate","params","id","$set","new","deletefacility","findByIdAndDelete","getfacilit","findById","getfacility","facilit","find","bookrequest","bookingRequest","BookingRequest","emailSubject","emailBody","transporter","nodemailer","createTransport","host","port","auth","user","EMAIL_USER","pass","EMAIL_PASS","message","firstname","subFacility","date","time","mailOptions","from","to","email","subject","html","sendMail","info","console","log","response"],"sources":["../../../src/Controller/AdminController.js"],"sourcesContent":["import facility from \"../model/AdminModel.js\";\r\nimport BookingRequest from \"../model/bookUserModel\";\r\nimport  Router  from 'express';\r\nconst router = Router();\r\nimport bodyParser from 'body-parser';\r\nimport multer from \"multer\";\r\nconst path = require(\"path\");\r\nimport express from \"express\";\r\nimport dotenv from 'dotenv';\r\nimport nodemailer from 'nodemailer';\r\ndotenv.config();\r\n\r\n\r\nconst app = express();\r\n// app.use(express.json());\r\nrouter.use(express.json());\r\nrouter.use(\"/images\", express.static(path.join(process.cwd(), \"/images\")));\r\nrouter.use(bodyParser.urlencoded({ extended: true }))\r\nrouter.use(bodyParser.json());\r\n// ===================cloudinary configuration=======================\r\nimport { v2 as cloudinary } from 'cloudinary';\r\ncloudinary.config({\r\n  cloud_name:process.env.CLOUDNAME,\r\n  api_key:process.env.API_KEY,\r\n  api_secret:process.env.API_SECRET\r\n});\r\nexport var upload = multer({\r\n  storage: multer.diskStorage({}),\r\n  fileFilter: (req, file, cb) => {\r\n    try {\r\n      let ext = path.extname(file.originalname);\r\n      if (ext !== \".pdf\" && ext !== \".JPG\" && ext !== \".JPEG\" && ext !== \".PNG\" && ext !== \".jpg\" && ext !== \".jpeg\" && ext !== \".png\"){\r\n        return cb(new Error(\"File type is not supported\"), false);\r\n      }\r\n      cb(null, true);\r\n    } catch (error) {\r\n      return cb(error, false);\r\n    }\r\n  },\r\n});\r\n// import { createError } from \"../utils/error.js\";\r\n\r\n// ==================creation of availability facility===========\r\nexport const createfacility = async (req, res, next) => {\r\n  \r\n  try {\r\n  if (!req.file) \r\n  return res.send('Please upload a file');\r\n  const result = await cloudinary.uploader.upload(req.file.path);\r\n  const newfacility = new facility({\r\n    facility: req.body.facility,\r\n    desc: req.body.desc,\r\n    image: result.secure_url,\r\n  });\r\n  // const newfacility = new facility({\r\n  //   ...req.body,\r\n  //   image: result.secure_url,\r\n  // });\r\n    const savedfacility = await newfacility.save();\r\n    res.status(200).json(savedfacility);\r\n  } catch (err) {\r\n    next(err);\r\n  }\r\n};\r\n\r\n// ==================update facility==========================\r\n\r\nexport const updatefacility = async (req, res, next) => {\r\n    try {\r\n      const updatedfacility = await facility.findByIdAndUpdate(\r\n        req.params.id,\r\n        { $set: req.body },\r\n        { new: true }\r\n      );\r\n      res.status(200).json(updatedfacility);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n\r\n//   ==============================delete availability==========================\r\n\r\nexport const deletefacility = async (req, res, next) => {\r\n    try {\r\n      await facility.findByIdAndDelete(req.params.id);\r\n      res.status(200).json(\"facility has been deleted.\");\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n\r\n  // =======================get one facility=============================\r\n  export const getfacilit = async (req, res, next) => {\r\n    try {\r\n      const getfacilit = await facility.findById(req.params.id);\r\n      res.status(200).json(getfacilit);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n//   ==========================get facility availability==========================\r\nexport const getfacility = async (req, res, next) => {\r\n    try {\r\n      const facilit = await facility.find();\r\n      res.status(200).json(facilit);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n\r\n// \r\n// =======================admin for approving a request=================\r\n\r\n// Endpoint for admins to approve or reject booking requests\r\nexport const bookrequest= async (req, res) => {\r\n  try {\r\n    const bookingRequest = await BookingRequest.findById(req.params.id);\r\n    let emailSubject;\r\n    let emailBody;\r\n    const transporter = nodemailer.createTransport({\r\n      host: 'smtp.gmail.com',\r\n      port: 587,\r\n      auth: {\r\n        user: process.env.EMAIL_USER,\r\n        pass: process.env.EMAIL_PASS\r\n      }\r\n    });\r\n    if (!bookingRequest) {\r\n      return res.status(404).json({ message: 'Booking request not found' });\r\n    }\r\n    if (req.body.status === 'Approved') {\r\n      bookingRequest.status = req.body.status;\r\n      await bookingRequest.save();\r\n      // ============message========================\r\n      emailSubject = 'Booking Confirmation';\r\n      emailBody = `<p>Dear ${bookingRequest.firstname},</p>\r\n                   <p>Your booking has been confirmed.</p>\r\n                   <p>Booking details:</p>\r\n                   <ul>\r\n                     <li>Facility: ${bookingRequest.subFacility}</li>\r\n                     <li>Date: ${bookingRequest.date}</li>\r\n                     <li>Time: ${bookingRequest.time}</li>\r\n                   </ul>`;\r\n        // ============================================\r\n      res.json({ message: 'Booking request approved successfully' });\r\n    } else if (req.body.status === 'Rejected'){\r\n      bookingRequest.status = req.body.status;\r\n      await bookingRequest.save();\r\n      // ===================mesage====================\r\n      emailSubject = 'Booking Rejection';\r\n      emailBody = `<p>Dear ${bookingRequest.firstname},</p>\r\n               <p>Your booking has been rejected.</p>\r\n               <p>Please contact us for more details.</p>`;\r\n      res.json({ message: 'Booking request rejected successfully' });\r\n    }\r\n    else {\r\n      res.status(400).json({ message: 'Invalid booking request status' });\r\n    }\r\n\r\n    const mailOptions = {\r\n      from: process.env.EMAIL_USER,\r\n      to: bookingRequest.email,\r\n      subject: emailSubject,\r\n      html: emailBody\r\n    };\r\n    \r\n    transporter.sendMail(mailOptions, (error, info) => {\r\n      if (error) {\r\n        console.error(error);\r\n      } else {\r\n        console.log('Email sent: ' + info.response);\r\n      }\r\n    });\r\n  } catch (error) {\r\n    console.error(error);\r\n    res.status(500).json({ message: 'Failed to update booking request' });\r\n  }\r\n};"],"mappings":"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"}