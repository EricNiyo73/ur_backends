{"version":3,"file":"bookUserController.js","names":["_bookUserModel","_interopRequireDefault","require","_userModel","_nodemailer","obj","__esModule","default","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","createbooking","req","user","User","findById","params","userId","status","json","message","date","body","time","existingBooking","book","findOne","subFacility","bookingData","firstname","lastname","email","booking","save","err","console","error","exports","updatebook","next","updatedbook","findByIdAndUpdate","id","$set","new","deletebook","findByIdAndDelete","data","getbook","getbooks","books","find"],"sources":["../../../src/Controller/bookUserController.js"],"sourcesContent":["import book from \"../model/bookUserModel.js\";\r\nimport User from '../model/userModel.js';\r\nimport nodemailer from 'nodemailer';\r\n// ==================creation of availability book===========\r\n\r\nexport const createbooking = async (req, res) => {\r\n  try {\r\n    const user = await User.findById(req.params.userId);\r\n    if (!user){\r\n      return res.status(404).json({message: \"User not found\"});\r\n    }\r\n    const date = req.body.date; \r\n    const time = req.body.time;\r\n    // const existingBooking = await book.findOne({\r\n    //   availability: {\r\n    //     $elemMatch: {\r\n    //       date: { $eq: date },\r\n    //       time: { $eq: time }\r\n    //     }\r\n    //   }\r\n    //   // 'availability.isAvailable': true,\r\n    //   // maxPeople: { $gte: capacity },\r\n    // });\r\n    const existingBooking  = await book.findOne({ \r\n      subFacility: req.body.subFacility,\r\n      date: req.body.date,\r\n      time: req.body.time,\r\n    });\r\n\r\n    if (existingBooking) {\r\n      return res.status(401).json(\"No available booking for the specified date and time\");\r\n    } \r\n    else{\r\n    const bookingData = {\r\n      ...req.body,\r\n        firstname: user.firstname,\r\n        lastname: user.lastname,\r\n        email: user.email\r\n      \r\n    };\r\n    // create a new booking\r\n    const booking = new book(bookingData);\r\n    // booking.roomUser = availableBooking._id;\r\n\r\n    await booking.save();\r\n\r\n    return res.status(200).json({\r\n      message: \"Booking request submitted successfully\",\r\n      booking,\r\n    });\r\n  }} catch (err) {\r\n    console.error(err);\r\n    return res.status(500).json(\"failed\");\r\n  }\r\n};\r\n\r\n// export const createbooking = async (req, res,date, time,capacity) => {\r\n//   try{\r\n//   book.findOne({ \r\n//     'availability.date': date, \r\n//     'availability.time': time, \r\n//     'availability.isAvailable': true},\r\n//      (err, bookuser) => {\r\n//     if (err) {\r\n//       return res.status(500).json(\"there is an error\");\r\n//     } else if (!bookuser) {\r\n//       return res.status(401).json(\"No available booking for the specified date and time\");\r\n//     } else {\r\n//       // create a new booking\r\n//       const booking = new book(req.body);\r\n\r\n//       booking.save((err,booking)=>{\r\n//         if(err){\r\n//           return res.status(500).json(\"failed\");\r\n//         }\r\n//         else {\r\n//           return res.status(200).json({\r\n//             message: \"success\",\r\n//             booking\r\n//           });\r\n//         }\r\n//       });\r\n//     }\r\n//   });\r\n//   } catch (err) {\r\n//     next(err);\r\n//   }\r\n  // const newbook = new book(req.body);\r\n\r\n  // try {\r\n  //   const savedbook = await newbook.save();\r\n  //   res.status(200).json(savedbook);\r\n  // } catch (err) {\r\n  //   next(err);\r\n  // }\r\n// };\r\n\r\n// ==================update book==========================\r\n\r\nexport const updatebook = async (req, res, next) => {\r\n    try {\r\n      const updatedbook = await book.findByIdAndUpdate(\r\n        req.params.id,\r\n        { $set: req.body },\r\n        { new: true }\r\n      );\r\n      res.status(200).json(updatedbook);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n\r\n\r\n//   ==============================delete ==========================\r\n\r\nexport const deletebook = async (req, res) => {\r\n\r\n  try {\r\n    const booking = await book.findByIdAndDelete(req.params.id);\r\n    if (!booking) {\r\n      return res.status(404).json({\r\n        status: \"failed\",\r\n        message: \"booking not found\",\r\n      });\r\n    }\r\n    return res.status(204).json({\r\n      status: \"success\",\r\n      data: \"booking deleted successfuly\",\r\n    });\r\n  } catch (error) {\r\n    return res.status(400).json({ status: \"failed\", error });\r\n  }\r\n  };\r\n\r\n//   ==============================get one book================================\r\nexport const getbook = async (req, res, next) => {\r\n    try {\r\n      const getbook = await book.findById(req.params.id);\r\n      res.status(200).json(getbook);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };\r\n//   ==========================get books availability==========================\r\nexport const getbooks = async (req, res, next) => {\r\n    try {\r\n      const books = await book.find();\r\n      res.status(200).json(books);\r\n    } catch (err) {\r\n      next(err);\r\n    }\r\n  };"],"mappings":"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"}