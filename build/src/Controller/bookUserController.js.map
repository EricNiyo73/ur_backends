{"version":3,"file":"bookUserController.js","names":["_bookUserModel","_interopRequireDefault","require","_userModel","_nodemailer","obj","__esModule","default","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","checkAvailability","req","existingBooking","book","findOne","subFacility","body","date","time","status","json","err","console","error","exports","createbooking","log","user","User","findById","params","userId","message","bookingdata","firstname","lastname","email","booking","save","bookingData","updatebook","next","updatedbook","findByIdAndUpdate","id","$set","new","deletebook","findByIdAndDelete","data","getbook","getbooks","books","find"],"sources":["../../../src/Controller/bookUserController.js"],"sourcesContent":["import book from \"../model/bookUserModel.js\";\nimport User from \"../model/userModel.js\";\nimport nodemailer from \"nodemailer\";\n\n// ==============check Availability====================\n\nexport const checkAvailability = async (req, res) => {\n  try{\n  const existingBooking = await book.findOne({\n    subFacility: req.body.subFacility,\n    date: req.body.date,\n  });\n  if (existingBooking) {\n    if (\n      ((existingBooking.time === \"Morning\") &&   (req.body.time === \"Morning\" || req.body.time === \"Fullday\")) &&\n      (existingBooking.status === \"Approved\"))\n     {\n      return res\n        .status(403)\n        .json(\"No available booking for the specified date and time1\");\n     } \n     else if (\n      (existingBooking.time === \"Afternoon\") &&\n       ( req.body.time === \"Afternoon\" || req.body.time === \"Fullday\") \n       && (existingBooking.status ===\"Approved\")\n    ) {\n      return res\n        .status(403)\n        .json(\"No available booking for the specified date and time2\");\n    } \n    else if (\n      (existingBooking.time === \"Fullday\" ) &&\n       ( req.body.time === \"Afternoon\" ||\n      req.body.time === \"Morning\" ||\n      req.body.time === \"Fullday\")\n      && (existingBooking.status ===\"Approved\")\n    ) {\n      return res\n        .status(403)\n        .json(\"No available booking for the specified date and time tird\");\n    }\n    else {\n      return res\n        .status(201)\n        .json(\"you can book this book\");\n    }\n    } else {\n      return res\n       .status(200)\n       .json(\"you can book now\");\n    \n}\n} catch (err) {\n  console.error(err);\n  return res.status(500).json(err);\n}\n}\n// ==================creation of availability book===========\n\nexport const createbooking = async (req, res) => {\n  console.log(req.body.time);\n  try {\n    const user = await User.findById(req.params.userId);\n    if (!user) {\n      return res.status(404).json({ message: \"User not found\" });\n    }\n\n    const existingBooking = await book.findOne({\n      subFacility: req.body.subFacility,\n      date: req.body.date,\n    });\n    if (existingBooking) {\n      if (\n        ((existingBooking.time === \"Morning\") &&   (req.body.time === \"Morning\" || req.body.time === \"Fullday\")) &&\n        (existingBooking.status === \"Approved\"))\n       {\n        return res\n          .status(403)\n          .json(\"No available booking for the specified date and time1\");\n       } \n       else if (\n        (existingBooking.time === \"Afternoon\") &&\n         ( req.body.time === \"Afternoon\" || req.body.time === \"Fullday\") \n         && (existingBooking.status ===\"Approved\")\n      ) {\n        return res\n          .status(403)\n          .json(\"No available booking for the specified date and time2\");\n      } \n      else if (\n        (existingBooking.time === \"Fullday\" ) &&\n         ( req.body.time === \"Afternoon\" ||\n        req.body.time === \"Morning\" ||\n        req.body.time === \"Fullday\")\n        && (existingBooking.status ===\"Approved\")\n      ) {\n        return res\n          .status(403)\n          .json(\"No available booking for the specified date and time tird\");\n      }\n      else {\n        const bookingdata = {\n          ...req.body,\n          firstname: user.firstname,\n          lastname: user.lastname,\n          email: user.email,\n        };\n        // create a new booking\n        const booking = new book(bookingdata);\n        // booking.roomUser = availableBooking._id;\n  \n        await booking.save();\n  \n        return res.status(200).json({\n          message: \"Booking request submitted successfully\",\n          booking,\n        });\n      }\n     } else {\n      const bookingData = {\n        ...req.body,\n        firstname: user.firstname,\n        lastname: user.lastname,\n        email: user.email,\n      };\n      // create a new booking\n      const booking = new book(bookingData);\n      // booking.roomUser = availableBooking._id;\n\n      await booking.save();\n\n      return res.status(200).json({\n        message: \"Booking request submitted successfully\",\n        booking,\n      });\n    }\n  } catch (err) {\n    console.error(err);\n    return res.status(500).json(err);\n  }\n};\n\n\n// ==================update book==========================\n\nexport const updatebook = async (req, res, next) => {\n  try {\n    const updatedbook = await book.findByIdAndUpdate(\n      req.params.id,\n      { $set: req.body },\n      { new: true }\n    );\n    res.status(200).json(updatedbook);\n  } catch (err) {\n    next(err);\n  }\n};\n\n//   ==============================delete ==========================\n\nexport const deletebook = async (req, res) => {\n  try {\n    const booking = await book.findByIdAndDelete(req.params.id);\n    if (!booking) {\n      return res.status(404).json({\n        status: \"failed\",\n        message: \"booking not found\",\n      });\n    }\n    return res.status(204).json({\n      status: \"success\",\n      data: \"booking deleted successfuly\",\n    });\n  } catch (error) {\n    return res.status(400).json({ status: \"failed\", error });\n  }\n};\n\n//   ==============================get one book================================\nexport const getbook = async (req, res, next) => {\n  try {\n    const getbook = await book.findById(req.params.id);\n    res.status(200).json(getbook);\n  } catch (err) {\n    next(err);\n  }\n};\n//   ==========================get books availability==========================\nexport const getbooks = async (req, res, next) => {\n  try {\n    const books = await book.find();\n    res.status(200).json(books);\n  } catch (err) {\n    next(err);\n  }\n};\n\n"],"mappings":"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"}