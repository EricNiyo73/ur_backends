{"version":3,"file":"bookUserController.js","names":["_bookUserModel","_interopRequireDefault","require","_userModel","_nodemailer","obj","__esModule","default","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","createbooking","req","console","log","body","time","user","User","findById","params","userId","status","json","message","existingBooking","book","findOne","subFacility","date","bookingData","firstname","lastname","email","booking","save","err","error","exports","updatebook","next","updatedbook","findByIdAndUpdate","id","$set","new","deletebook","findByIdAndDelete","data","getbook","getbooks","books","find"],"sources":["../../../src/Controller/bookUserController.js"],"sourcesContent":["import book from \"../model/bookUserModel.js\";\nimport User from \"../model/userModel.js\";\nimport nodemailer from \"nodemailer\";\n// ==================creation of availability book===========\n\nexport const createbooking = async (req, res) => {\n  console.log(req.body.time);\n  try {\n    const user = await User.findById(req.params.userId);\n    if (!user) {\n      return res.status(404).json({ message: \"User not found\" });\n    }\n\n    const existingBooking = await book.findOne({\n      subFacility: req.body.subFacility,\n      date: req.body.date,\n    });\n    if (existingBooking) {\n      if (\n        (existingBooking.time === \"Morning\" && req.body.time === \"Morning\") ||\n        req.body.time === \"Fullday\"\n      ) {\n        return res\n          .status(403)\n          .json(\"No available booking for the specified date and time1\");\n      } else if (\n        (existingBooking.time === \"Afternoon\" &&\n          req.body.time === \"Afternoon\") ||\n        req.body.time === \"Fullday\"\n      ) {\n        return res\n          .status(403)\n          .json(\"No available booking for the specified date and time2\");\n      } else {\n        return res\n          .status(403)\n          .json(\"No available booking for the specified date and time3\");\n      }\n    } else {\n      const bookingData = {\n        ...req.body,\n        firstname: user.firstname,\n        lastname: user.lastname,\n        email: user.email,\n      };\n      // create a new booking\n      const booking = new book(bookingData);\n      // booking.roomUser = availableBooking._id;\n\n      await booking.save();\n\n      return res.status(200).json({\n        message: \"Booking request submitted successfully\",\n        booking,\n      });\n    }\n  } catch (err) {\n    console.error(err);\n    return res.status(500).json(err);\n  }\n};\n\n// export const createbooking = async (req, res,date, time,capacity) => {\n//   try{\n//   book.findOne({\n//     'availability.date': date,\n//     'availability.time': time,\n//     'availability.isAvailable': true},\n//      (err, bookuser) => {\n//     if (err) {\n//       return res.status(500).json(\"there is an error\");\n//     } else if (!bookuser) {\n//       return res.status(401).json(\"No available booking for the specified date and time\");\n//     } else {\n//       // create a new booking\n//       const booking = new book(req.body);\n\n//       booking.save((err,booking)=>{\n//         if(err){\n//           return res.status(500).json(\"failed\");\n//         }\n//         else {\n//           return res.status(200).json({\n//             message: \"success\",\n//             booking\n//           });\n//         }\n//       });\n//     }\n//   });\n//   } catch (err) {\n//     next(err);\n//   }\n// const newbook = new book(req.body);\n\n// try {\n//   const savedbook = await newbook.save();\n//   res.status(200).json(savedbook);\n// } catch (err) {\n//   next(err);\n// }\n// };\n\n// ==================update book==========================\n\nexport const updatebook = async (req, res, next) => {\n  try {\n    const updatedbook = await book.findByIdAndUpdate(\n      req.params.id,\n      { $set: req.body },\n      { new: true }\n    );\n    res.status(200).json(updatedbook);\n  } catch (err) {\n    next(err);\n  }\n};\n\n//   ==============================delete ==========================\n\nexport const deletebook = async (req, res) => {\n  try {\n    const booking = await book.findByIdAndDelete(req.params.id);\n    if (!booking) {\n      return res.status(404).json({\n        status: \"failed\",\n        message: \"booking not found\",\n      });\n    }\n    return res.status(204).json({\n      status: \"success\",\n      data: \"booking deleted successfuly\",\n    });\n  } catch (error) {\n    return res.status(400).json({ status: \"failed\", error });\n  }\n};\n\n//   ==============================get one book================================\nexport const getbook = async (req, res, next) => {\n  try {\n    const getbook = await book.findById(req.params.id);\n    res.status(200).json(getbook);\n  } catch (err) {\n    next(err);\n  }\n};\n//   ==========================get books availability==========================\nexport const getbooks = async (req, res, next) => {\n  try {\n    const books = await book.find();\n    res.status(200).json(books);\n  } catch (err) {\n    next(err);\n  }\n};\n"],"mappings":"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"}